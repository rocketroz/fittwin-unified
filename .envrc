source_env_if_exists() { [ -f "$1" ] && eval "$(direnv dotenv bash "$1")"; }
branch="$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo main)"

# Per-branch creds outside git (adjust paths if you use ~/.proj-creds or ./.creds)
case "$branch" in
  acct1/*) source_env_if_exists "$HOME/.proj-creds/acct1.env" ;;
  acct2/*) source_env_if_exists "$HOME/.proj-creds/acct2.env" ;;
  acct3/*) source_env_if_exists "$HOME/.proj-creds/acct3.env" ;;
  *)       source_env_if_exists "$HOME/.proj-creds/default.env" ;;
esac

# Make overlay paths visible to your tooling (if it supports it)
export CODEX_OVERLAY_DIR="$PWD/.codex.local"
[ -f ./.env.shared ] && eval "$(direnv dotenv bash ./.env.shared)"
